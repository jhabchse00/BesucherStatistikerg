<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Statistik Zusammenfassung</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { border-collapse: collapse; margin-bottom: 30px; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #f0f0f0; }
  h2 { margin-top: 40px; }
</style>
</head>
<body>

<h1>Statistik Zusammenfassung</h1>

<h2>Rohdaten</h2>
<table id="rawTable">
  <thead>
    <tr>
      <th>Timestamp</th>
      <th>Alter</th>
      <th>Migrationshintergrund</th>
      <th>Geschlecht</th>
    </tr>
  </thead>
  <tbody>
    <!-- Rohdaten rows will appear here -->
  </tbody>
</table>

<h2>Zusammenfassung</h2>
<table id="summaryTable">
  <thead>
    <tr>
      <th>Alter</th>
      <th>Migrationshintergrund</th>
      <th>Geschlecht</th>
      <th>Anzahl</th>
    </tr>
  </thead>
  <tbody>
    <!-- Zusammenfassung rows will appear here -->
  </tbody>
</table>

<script>
// CSV URL
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRaFKAQwcvl7c7dT1HI_aj7THVW9DKYLGXPtvn_WR7uYEAzxyUjH3DVmTFxZefhWF5FcXoHnK-XJim5/pub?gid=1664273841&single=true&output=csv";

// Allowed categories
const ageGroups = ["10-14","14-18","18-27","27+"];
const migrationStatus = ["Ja","Nein"];
const genders = ["MÃ¤nnlich","Weiblich","Divers"];

// Helper: parse CSV
function parseCSV(csv) {
    const lines = csv.trim().split("\n");
    const headers = lines.shift().split(",");
    return lines.map(line => {
        const values = line.split(",");
        const obj = {};
        headers.forEach((h, i) => obj[h.trim()] = values[i].trim());
        return obj;
    });
}

// Helper: create table rows
function createTableRows(data) {
    return data.map(row => `<tr>
        <td>${row.Timestamp}</td>
        <td>${row.Alter}</td>
        <td>${row.Migrationshintergrund}</td>
        <td>${row.Geschlecht}</td>
    </tr>`).join("");
}

// Helper: create summary table
function createSummaryTable(data) {
    const summary = {};

    data.forEach(row => {
        const age = ageGroups.includes(row.Alter) ? row.Alter : "Unbekannt";
        const mig = migrationStatus.includes(row.Migrationshintergrund) ? row.Migrationshintergrund : "Unbekannt";
        const gender = genders.includes(row.Geschlecht) ? row.Geschlecht : "Unbekannt";

        const key = `${age}|${mig}|${gender}`;
        summary[key] = (summary[key] || 0) + 1;
    });

    const rows = Object.entries(summary).map(([key, count]) => {
        const [age, mig, gender] = key.split("|");
        return `<tr>
            <td>${age}</td>
            <td>${mig}</td>
            <td>${gender}</td>
            <td>${count}</td>
        </tr>`;
    });

    return rows.join("");
}

// Fetch CSV and render tables
fetch(csvUrl)
.then(response => response.text())
.then(csvText => {
    const data = parseCSV(csvText);

    document.querySelector("#rawTable tbody").innerHTML = createTableRows(data);
    document.querySelector("#summaryTable tbody").innerHTML = createSummaryTable(data);
})
.catch(err => {
    console.error("CSV konnte nicht geladen werden:", err);
    document.body.innerHTML += "<p style='color:red;'>Fehler beim Laden der Daten.</p>";
});
</script>

</body>
</html>
